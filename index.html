<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tr√¨nh ph√°t MIDI tr·ª±c tuy·∫øn</title>

  <!-- Th∆∞ vi·ªán MIDI -->
  <script src="https://cdn.jsdelivr.net/combine/npm/tone@14.7.77,npm/@magenta/music@1.23.1/es6/core.js,npm/html-midi-player@1.4.0"></script>

  <style>
    body {
      background: #111;
      color: #eee;
      font-family: sans-serif;
      text-align: center;
      margin: 0;
      padding: 20px;
    }

    h2 {
      margin-top: 10px;
      margin-bottom: 8px;
    }

    #guide {
      font-size: 16px;
      color: #ffb400;
      margin-bottom: 12px;
    }
    #guide .highlight {
      color: #fff;
      font-weight: bold;
    }

    .small-player-section {
      margin: 15px 0 10px 0;
    }
    .small-player-title {
      font-size:16px;
      color:#ffb400;
      font-weight:bold;
      margin-bottom:6px;
    }
    .small-player-audio {
      width:220px;
      background:#222;
      border-radius:6px;
      box-shadow:0 2px 8px #0002;
    }

    #songName {
      font-size: 15px;
      color: #ccc;
      margin-bottom: 8px;
    }

    #fileInput {
      display: block;
      margin: 10px auto 15px auto;
      padding: 8px 12px;
      background: #333;
      border: 1px solid #444;
      color: white;
      border-radius: 6px;
      cursor: pointer;
    }
    #fileInput:hover {
      background: #444;
    }

    midi-player {
      width: 100%;
      background: #222 !important;
      border-radius: 10px;
      padding: 6px 0;
      --midi-player-border-color: #333;
      --midi-player-bg: #222;
      --midi-player-btn-bg: #333;
      --midi-player-btn-color: #fff;
      --midi-player-btn-hover-bg: #555;
      --midi-player-seek-bar-color: #0af;
      --midi-player-time-color: #ff2323;
      --midi-player-font-family: sans-serif;
      --midi-player-border-radius: 10px;
    }

    midi-visualizer {
      width: 100%;
      height: 300px;
      border: 1px solid #333;
      background: #000;
      display: block;
      margin-top: 10px;
      margin-bottom: 0px;
    }

    midi-player::part(time) {
      color: #ff2323 !important;
    }
    midi-player >>> .time,
    midi-player ::part(time),
    midi-player /deep/ .time,
    midi-player ::-webkit-deep .time {
      color: #ff2323 !important;
    }

    .download-section {
      margin-top: 40px;
      text-align: left;
      display: inline-block;
      background: #222;
      border-radius: 8px;
      padding: 16px 24px;
      color: #eee;
      box-shadow: 0 4px 16px #0002;
    }
    .download-section h3 {
      color: #ffb400;
      margin-bottom: 12px;
      margin-top: 0;
    }
    .download-section ul {
      padding-left: 18px;
      margin: 0;
      text-align: left;
    }
    .download-section li {
      margin-bottom: 6px;
      font-size: 15px;
    }
    .download-section a {
      color: #4fc3f7;
      text-decoration: underline;
      font-weight: bold;
      word-break: break-all;
    }
    .download-section a:hover {
      color: #ffd700;
    }
    .download-more {
      margin-top: 12px;
      font-size: 15px;
    }
    .download-more a {
      color: #ffb400;
      font-weight: bold;
      text-decoration: underline;
    }
    .download-more a:hover {
      color: #ffd700;
    }
  </style>
</head>

<body>
  <h2>üéµ Tr√¨nh ph√°t MIDI tr·ª±c tuy·∫øn</h2>
  <div id="guide">
    H∆∞·ªõng d·∫´n : nh·∫•p v√†o <span class="highlight">Ch·ªçn t·ªáp</span> ƒë·ªÉ load .mid r·ªìi b·∫•m ph√°t, midi s·∫Ω kh√¥ng c√≥ √¢m thanh n·∫øu ƒët b·∫≠t ch·∫ø ƒë·ªô im l·∫∑ng
  </div>
  <!-- Tr√¨nh ph√°t nh·∫°c nh·ªè g·ªçn preload -->
  <div class="small-player-section">
    <div class="small-player-title">Player Demo t·ªÅ thi√™n</div>
    <audio class="small-player-audio" controls preload="auto">
      <source src="https://github.com/nhut990/files/raw/refs/heads/main/music/Tethien.mid-to.mp3" type="audio/mp3">
      Tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng h·ªó tr·ª£ ph√°t audio.
    </audio>
  </div>
  <!-- K·∫øt th√∫c tr√¨nh ph√°t nh·∫°c nh·ªè g·ªçn preload -->
  <div id="songName">Ch∆∞a ch·ªçn b√†i</div>
  <input type="file" id="fileInput" accept=".mid,.midi">
  <midi-player id="player" sound-font visualizer="#visualizer"></midi-player>
  <midi-visualizer type="piano-roll" id="visualizer"></midi-visualizer>
  <br><br><br><br><br>
  <div class="download-section">
    <h3>üéº M·ªôt s·ªë li√™n k·∫øt t·∫£i MIDI:</h3>
    <ul>
      <li>Cho v·ª´a l√≤ng em: <a href="https://github.com/nhut990/files/raw/refs/heads/main/music/Midi/Cho%20vua%20long%20em.mid" download>Download</a></li>
      <li>Ch√∫t k·ª∑ ni·ªám bu·ªìn: <a href="https://github.com/nhut990/files/raw/refs/heads/main/music/Midi/ChutKyNiemBuon.mid" download>Download</a></li>
      <li>C√¢u chuy·ªán ƒë·∫ßu nƒÉm: <a href="https://github.com/nhut990/files/raw/refs/heads/main/music/Midi/Cau%20Chuyen%20Dau%20Nam.mid" download>Download</a></li>
      <li>Gi·ªçt l·ªá ƒë√†i trang: <a href="https://github.com/nhut990/files/raw/refs/heads/main/music/Midi/Giot%20le%20dai%20trang.mid" download>Download</a></li>
      <li>M∆∞a phi tr∆∞·ªùng: <a href="https://github.com/nhut990/files/raw/refs/heads/main/music/Midi/Mua%20phi%20truong.midi" download>Download</a></li>
      <li>B√†i ca k·ª∑ ni·ªám: <a href="https://github.com/nhut990/files/raw/refs/heads/main/music/Midi/bai%20ca%20ky%20niem%20.mid" download>Download</a></li>
      <li>T·ªÅ thi√™n ƒë·∫°i th√°nh: <a href="https://github.com/nhut990/files/raw/refs/heads/main/music/Midi/tethien.mid" download>Download</a></li>
      <li>Lan v√† ƒëi·ªáp: <a href="https://github.com/nhut990/files/raw/refs/heads/main/music/Midi/Lanvadiep.mid" download>Download</a></li>
    </ul>
    <div class="download-more">
      Download th√™m midi <a href="https://nhut990.github.io/playmidi/mid/" target="_blank"><b>T·∫°i ƒê√¢y</b></a>
    </div>
  </div>

  <div style="margin-top: 50px; text-align: center;">
    <a href="https://nhut990.github.io/" style="font-size: 18px; color: #4fc3f7; font-weight: bold; text-decoration: underline;">Tr·ªü l·∫°i trang ch·ªß</a>
  </div>

  <script>
    const fileInput = document.getElementById('fileInput');
    const player = document.getElementById('player');
    const songName = document.getElementById('songName');
    const visualizer = document.getElementById('visualizer');

    function fixMidiTimeColor() {
      function tryFix() {
        const shadow = player.shadowRoot;
        if (shadow) {
          const timeEls = shadow.querySelectorAll('.time');
          timeEls.forEach(el => el.style.color = '#ff2323');
        }
      }
      for (let i = 0; i < 5; i++) {
        setTimeout(tryFix, 200 + i * 200);
      }
    }

    fileInput.addEventListener('change', function () {
      const file = this.files[0];
      if (file) {
        if (typeof player.stop === 'function') player.stop();
        player.currentTime = 0;

        if (typeof visualizer.seekTo === 'function') {
          visualizer.seekTo(0);
        } else {
          visualizer.currentTime = 0;
          visualizer.dispatchEvent(new CustomEvent('midi-visualizer-seek', { detail: { currentTime: 0 } }));
        }

        const url = URL.createObjectURL(file);
        player.src = url;
        songName.textContent = 'ƒêang ph√°t: ' + file.name;

        setTimeout(() => {
          if (typeof player.play === 'function') player.play();
          fixMidiTimeColor();
        }, 400);
      }
    });

    window.addEventListener('DOMContentLoaded', fixMidiTimeColor);
  </script>
</body>
</html>